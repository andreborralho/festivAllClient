(function(e){function s(e,t){var n=e;var r=t;var i=Math.round(Math.sqrt(Math.pow(n,2)+Math.pow(r,2)));var s=Math.atan2(r,n);var o=Math.round(s*180/Math.PI);if(o<0){o=360-Math.abs(o)}if(o<=215&&o>=155||o<=45&&o>=0||o<=360&&o>=315){return true}else{return false}}var t=[];var r=function(t){if(!t.jqmCarouselId)t.jqmCarouselId=e.uuid();return t.jqmCarouselId};e.fn.carousel=function(e){var n,s;for(var o=0;o<this.length;o++){s=r(this[o]);if(!t[s]){n=new i(this[o],e);t[s]=n}else{n=t[s]}}return this.length==1?n:this};var i=function(){var r=e.feat.cssTransformStart;var i=e.feat.cssTransformEnd;var o=function(n,r){if(typeof n==="string"||n instanceof String){this.container=document.getElementById(n)}else{this.container=n}if(!this.container){alert("Error finding container for carousel "+n);return}if(this instanceof o){for(var i in r){if(r.hasOwnProperty(i)){this[i]=r[i]}}}else{return new o(n,r)}var s=this;jq(this.container).bind("destroy",function(e){var n=s.container.jqmCarouselId;window.removeEventListener("orientationchange",s.orientationHandler,false);if(t[n])delete t[n];e.stopPropagation()});this.pagingDiv=this.pagingDiv?document.getElementById(this.pagingDiv):null;this.container.style.overflow="hidden";if(this.vertical){this.horizontal=false}var u=document.createElement("div");this.container.appendChild(u);var a=e(u);var f=e(this.container);var l=Array.prototype.slice.call(this.container.childNodes);while(l.length>0){var c=l.splice(0,1);c=f.find(c);if(c.get()==u)continue;a.append(c.get())}if(this.horizontal){u.style.display="block";u.style["float"]="left"}else{u.style.display="block"}this.el=u;this.refreshItems();var h=jq(u);h.bind("touchmove",function(e){s.touchMove(e)});h.bind("touchend",function(e){s.touchEnd(e)});h.bind("touchstart",function(e){s.touchStart(e)});this.orientationHandler=function(){s.onMoveIndex(s.carouselIndex,0)};window.addEventListener("orientationchange",this.orientationHandler,false)};o.prototype={startX:0,startY:0,dx:0,dy:0,glue:false,myDivWidth:0,myDivHeight:0,cssMoveStart:0,childrenCount:0,carouselIndex:0,vertical:false,horizontal:true,el:null,movingElement:false,container:null,pagingDiv:null,pagingCssName:"carousel_paging",pagingCssNameSelected:"carousel_paging_selected",pagingFunction:null,lockMove:false,okToMove:false,touchStart:function(t){this.okToMove=false;this.myDivWidth=numOnly(this.container.clientWidth);this.myDivHeight=numOnly(this.container.clientHeight);this.lockMove=false;if(t.touches[0].target&&t.touches[0].target.type!==undefined){var n=t.touches[0].target.tagName.toLowerCase();if(n==="select"||n==="input"||n==="button"){return}}if(t.touches.length===1){this.movingElement=true;this.startY=t.touches[0].pageY;this.startX=t.touches[0].pageX;var r=e.getCssMatrix(this.el);if(this.vertical){try{this.cssMoveStart=numOnly(r.f)}catch(i){this.cssMoveStart=0}}else{try{this.cssMoveStart=numOnly(r.e)}catch(i){this.cssMoveStart=0}}}},touchMove:function(t){if(!this.movingElement)return;if(t.touches.length>1){return this.touchEnd(t)}var n={x:t.touches[0].pageX-this.startX,y:t.touches[0].pageY-this.startY};if(this.vertical){var r={x:0,y:0};this.dy=t.touches[0].pageY-this.startY;this.dy+=this.cssMoveStart;r.y=this.dy;t.preventDefault()}else{if(!this.lockMove&&s(n.x,n.y)){var r={x:0,y:0};this.dx=t.touches[0].pageX-this.startX;this.dx+=this.cssMoveStart;t.preventDefault();r.x=this.dx}else return this.lockMove=true}var i=this.vertical?this.dy%this.myDivHeight/this.myDivHeight*100*-1:this.dx%this.myDivWidth/this.myDivWidth*100*-1;var o=this.carouselIndex;if(o==0&&i<0)return;if(this.dx*-1>this.myDivWidth*(this.childrenCount-1)){return}if(!this.okToMove){oldStateOkToMove=this.okToMove;this.okToMove=this.glue?Math.abs(i)>this.glue&&Math.abs(i)<100-this.glue:true;if(this.okToMove&&!oldStateOkToMove){e.trigger(this,"movestart",[this.el])}}if(this.okToMove&&r)this.moveCSS3(this.el,r)},touchEnd:function(t){if(!this.movingElement){return}e.trigger(this,"movestop",[this.el]);var n=false;try{var r=e.getCssMatrix(this.el);var i=this.vertical?numOnly(r.f):numOnly(r.e);if(1==2&&i>0){this.moveCSS3(this.el,{x:0,y:0},"300")}else{var s=this.vertical?this.dy%this.myDivHeight/this.myDivHeight*100*-1:this.dx%this.myDivWidth/this.myDivWidth*100*-1;var o=this.carouselIndex;if(i<this.cssMoveStart&&s>10){o++}else if(i>this.cssMoveStart&&s<90){o--}var u=o;if(o>this.childrenCount-1){o=0;u=this.childrenCount;return}if(o<0){o=this.childrenCount-1;u=-1;return}var a={x:0,y:0};if(this.vertical){a.y=u*this.myDivHeight*-1}else{a.x=u*this.myDivWidth*-1}this.moveCSS3(this.el,a,"150");if(this.pagingDiv&&this.carouselIndex!==o){document.getElementById(this.container.id+"_"+this.carouselIndex).className=this.pagingCssName;document.getElementById(this.container.id+"_"+o).className=this.pagingCssNameSelected}if(this.carouselIndex!=o)n=true;this.carouselIndex=o;if(u!=o){var f=this;window.setTimeout(function(){f.onMoveIndex(o,"1ms")},155)}}}catch(t){console.log(t)}this.dx=0;this.movingElement=false;this.startX=0;this.dy=0;this.startY=0;if(n&&this.pagingFunction&&typeof this.pagingFunction=="function")this.pagingFunction(this.carouselIndex)},onMoveIndex:function(e,t){this.myDivWidth=numOnly(this.container.clientWidth);this.myDivHeight=numOnly(this.container.clientHeight);var n=false;if(document.getElementById(this.container.id+"_"+this.carouselIndex))document.getElementById(this.container.id+"_"+this.carouselIndex).className=this.pagingCssName;var r=Math.abs(e-this.carouselIndex);var i=e;if(i<0)i=0;if(i>this.childrenCount-1){i=this.childrenCount-1}var s={x:0,y:0};if(this.vertical){s.y=i*this.myDivHeight*-1}else{s.x=i*this.myDivWidth*-1}var o=t?t:50+parseInt(r*20);this.moveCSS3(this.el,s,o);if(this.carouselIndex!=i)n=true;this.carouselIndex=i;if(this.pagingDiv){var u=document.getElementById(this.container.id+"_"+this.carouselIndex);if(u)u.className=this.pagingCssNameSelected}if(n&&this.pagingFunction&&typeof this.pagingFunction=="function")this.pagingFunction(currInd)},moveCSS3:function(t,n,s,o){if(!s)s=0;else s=parseInt(s);if(!o)o="linear";t.style[e.feat.cssPrefix+"Transform"]="translate"+r+n.x+"px,"+n.y+"px"+i;t.style[e.feat.cssPrefix+"TransitionDuration"]=s+"ms";t.style[e.feat.cssPrefix+"BackfaceVisibility"]="hidden";t.style[e.feat.cssPrefix+"TransformStyle"]="preserve-3d";t.style[e.feat.cssPrefix+"TransitionTimingFunction"]=o},addItem:function(e){if(e&&e.nodeType){this.container.childNodes[0].appendChild(e);this.refreshItems()}},refreshItems:function(){var t=0;var r=this;var i=this.el;e(i).find(".prevBuffer").remove();e(i).find(".nextBuffer").remove();n=i.childNodes[0];var s;var o="100%";var u=[];for(;n;n=n.nextSibling){if(n.nodeType===1){u.push(n);t++}}var a=e(u[u.length-1]).clone().get(0);a.className="prevBuffer";e(i).prepend(a);var f=e(u[0]).clone().get(0);f.className="nextBuffer";e(i).append(f);u.push(f);u.unshift(a);var l=100/t+"%";this.childrenCount=t;s=parseFloat(100/t)+"%";for(var c=0;c<u.length;c++){if(this.horizontal){u[c].style.width=s;u[c].style.height="100%";u[c].style["float"]="left"}else{u[c].style.height=s;u[c].style.width="100%";u[c].style.display="block"}}f.style.position="absolute";a.style.position="absolute";this.moveCSS3(i,{x:0,y:0});if(this.horizontal){i.style.width=Math.ceil(this.childrenCount*100)+"%";i.style.height="100%";i.style["min-height"]="100%";a.style.left="-"+s;f.style.left="100%"}else{i.style.width="100%";i.style.height=Math.ceil(this.childrenCount*100)+"%";i.style["min-height"]=Math.ceil(this.childrenCount*100)+"%";a.style.top="-"+s;f.style.top="100%"}if(this.pagingDiv){this.pagingDiv.innerHTML="";for(c=0;c<this.childrenCount;c++){var h=document.createElement("div");h.id=this.container.id+"_"+c;h.pageId=c;if(c!==this.carouselIndex){h.className=this.pagingCssName}else{h.className=this.pagingCssNameSelected}h.onclick=function(){r.onMoveIndex(this.pageId)};var p=document.createElement("div");p.style.width="20px";if(this.horizontal){p.style.display="inline-block";p.innerHTML=" "}else{p.innerHTML=" ";p.style.display="block"}this.pagingDiv.appendChild(h);if(c+1<this.childrenCount)this.pagingDiv.appendChild(p);h=null;p=null}if(this.horizontal){this.pagingDiv.style.width=this.childrenCount*50+"px";this.pagingDiv.style.height="25px"}else{this.pagingDiv.style.height=this.childrenCount*50+"px";this.pagingDiv.style.width="25px"}}this.onMoveIndex(this.carouselIndex)}};return o}()})(jq)